:root {
  --bg: #0e1116;
  --fg: #e6edf3;
  --muted: #9da7b1;
  --accent: #7cdd6b;
  --danger: #ff6b6b;
  --panel: #141922;
  --panel-border: #222738;
  --btn: #1f2633;
  --btn-hover: #2a3446;
  --shadow: 0 10px 25px rgba(0,0,0,.35);
  --cell: #12161f;
}
@media (prefers-color-scheme: light) {
  :root { --bg:#f7f9fc; --fg:#0f1720; --panel:#ffffff; --panel-border:#e5e9f0; --btn:#eef2f7; --btn-hover:#e2e8f0; --cell:#e9edf5; }
}
html, body { height:100%; }
body {
  margin:0;
  font-family:system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
  background:var(--bg); color:var(--fg);
  display:grid; grid-template-rows:auto 1fr auto; min-height:100dvh;
}
.app-header, .app-footer { padding:.75rem 1rem; display:flex; align-items:center; justify-content:space-between; background:transparent; }
.app-title { margin:0; font-size:clamp(1rem,3.5dvw,1.5rem); letter-spacing:.04em; }
.app-main { display:grid; grid-template-columns:1fr; gap:12px; align-items:start; padding:12px env(safe-area-inset-right) 12px env(safe-area-inset-left); }
.stage-wrap { position:relative; justify-self:center; box-shadow:var(--shadow); border-radius:16px; overflow:hidden; background:linear-gradient(180deg,#0b0f16,#0e1116); display:flex; align-items:center; justify-content:center; padding:env(safe-area-inset-top) 0 calc(env(safe-area-inset-bottom)+8px); min-height:100dvh; }
canvas#game { display:block; width:100%; height:auto; background:radial-gradient(120% 120% at 50% 0%, #0e1420 0%, #0b0f16 60%, #070a0e 100%); }

.sidebar { background:var(--panel); border:1px solid var(--panel-border); border-radius:12px; padding:12px; display:grid; gap:8px; align-self:start; box-shadow:var(--shadow); }
.sidebar h2 { margin:.2rem 0 .25rem; font-size:clamp(.8rem,2.5dvw,1rem); color:var(--muted); }
.hud-val { font-weight:700; font-size:clamp(1rem,4dvw,1.3rem); }

.mini { width: 100%; background: var(--cell); border-radius: 8px; }

.panel-wrap{position:fixed; inset:0; pointer-events:none;}
.panel { position:fixed; inset:0; display:flex; align-items:center; justify-content:center; padding:env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left); backdrop-filter:blur(8px); opacity:0; transform:translateY(20px); pointer-events:none; transition:opacity .2s ease, transform .2s ease; }
.panel.show { opacity:1; transform:translateY(0); pointer-events:auto; }
.panel > * { background:var(--panel); border:1px solid var(--panel-border); border-radius:16px; padding:18px; box-shadow:var(--shadow); min-width:clamp(260px,90dvw,360px); }
.panel h2 { margin-top: 0; }
.panel .grid2 { display:grid; grid-template-columns: 1fr 1fr; gap:10px; }
.panel .panel-actions { display:flex; gap:8px; margin-top: 12px; }

.help { margin:.5rem 0 0 1rem; line-height:1.7; }

.btn { appearance: none; border: 1px solid var(--panel-border); border-radius: 10px; background: var(--btn); color: var(--fg); padding: .6rem .9rem; cursor:pointer; transition: transform .05s ease, background .2s ease; }
.btn:hover { background: var(--btn-hover); transform: translateY(-1px); }
.btn.primary { background: linear-gradient(180deg,#2d8847,#2a6e41); border-color: rgba(0,0,0,.15); }
.btn.ghost { background: transparent; }

.touch-overlay{position:absolute; inset:0; display:none; touch-action:none;}
.touch-overlay .dpad{position:absolute; bottom:calc(env(safe-area-inset-bottom)+8px); left:calc(env(safe-area-inset-left)+8px); display:grid; grid-template-columns:repeat(2,1fr); grid-template-rows:repeat(2,1fr); gap:6px;}
.touch-overlay .actions{position:absolute; bottom:calc(env(safe-area-inset-bottom)+8px); right:calc(env(safe-area-inset-right)+8px); display:grid; grid-template-columns:repeat(2,1fr); grid-template-rows:repeat(2,1fr); gap:6px;}
.ctl{width:clamp(56px,12dvw,64px); height:clamp(56px,12dvw,64px); background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.15); color:var(--fg); border-radius:12px; font-size:1.1rem; position:relative; overflow:hidden; touch-action:none;}
.ctl:active, .ctl[aria-pressed="true"]{background:rgba(255,255,255,.12); transform:translateY(1px);}
.ctl::after{content:""; position:absolute; inset:0; border-radius:inherit; background:rgba(255,255,255,.25); transform:scale(0); opacity:0; transition:transform .3s ease, opacity .3s ease;}
.ctl:active::after, .ctl[aria-pressed="true"]::after{transform:scale(1); opacity:1;}
.ctl:focus-visible{outline:2px solid var(--accent); outline-offset:2px;}

@media (min-width:900px){
  .app-main{grid-template-columns:1fr 260px;}
  .sidebar{order:2;}
}

@media (prefers-reduced-motion: reduce){
  *,*::before,*::after{animation-duration:.01ms!important;animation-iteration-count:1!important;transition-duration:.01ms!important;}
}

/* FPS badge */
.fps { position:absolute; top:6px; left:6px; font: 12px/1.2 ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono"; opacity:.8; background: rgba(0,0,0,.35); padding:4px 6px; border-radius:6px; }
