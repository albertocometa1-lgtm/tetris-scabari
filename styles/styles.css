:root {
  --bg: #0e1116;
  --fg: #e6edf3;
  --muted: #9da7b1;
  --accent: #7cdd6b;
  --danger: #ff6b6b;
  --panel: #141922;
  --panel-border: #222738;
  --btn: #1f2633;
  --btn-hover: #2a3446;
  --shadow: 0 10px 25px rgba(0,0,0,.35);
  --cell: #12161f;
  --sat: env(safe-area-inset-top);
  --sar: env(safe-area-inset-right);
  --sab: env(safe-area-inset-bottom);
  --sal: env(safe-area-inset-left);
}
@media (prefers-color-scheme: light) {
  :root { --bg:#f7f9fc; --fg:#0f1720; --panel:#ffffff; --panel-border:#e5e9f0; --btn:#eef2f7; --btn-hover:#e2e8f0; --cell:#e9edf5; }
}
html, body { min-height:100%; }
body {
  margin:0;
  font-family:system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
  background:var(--bg); color:var(--fg);
  display:flex; flex-direction:column;
  min-height:100vh;
  align-items:center;
}
.app-header,
.app-main,
.app-footer {
  width:min(1200px, 100%);
  box-sizing:border-box;
  padding-left:clamp(32px,5vw,72px);
  padding-right:clamp(32px,5vw,72px);
}
.app-header {
  padding-top:32px;
  padding-bottom:0;
  display:flex;
  align-items:flex-start;
  justify-content:space-between;
  gap:32px;
  flex-wrap:wrap;
}
.app-footer {
  padding-top:24px;
  padding-bottom:24px;
  text-align:center;
  color:var(--muted);
}
.app-title { margin:0; font-size:clamp(1.4rem,2vw,2rem); letter-spacing:.04em; }
.command-menu {
  background:var(--panel);
  border:1px solid var(--panel-border);
  border-radius:16px;
  padding:16px 20px;
  box-shadow:var(--shadow);
  min-width:260px;
  margin-left:auto;
}
.command-menu h2 {
  margin:0 0 8px;
  font-size:.9rem;
  letter-spacing:.1em;
  text-transform:uppercase;
  color:var(--muted);
}
.command-menu ul {
  list-style:none;
  margin:0;
  padding:0;
  display:flex;
  flex-direction:column;
  gap:6px;
}
.command-menu li {
  display:flex;
  gap:12px;
  align-items:center;
  justify-content:flex-end;
  font-size:.9rem;
  color:var(--muted);
}
.keycap {
  font-family:"JetBrains Mono","Space Mono",ui-monospace,monospace;
  border:1px solid var(--panel-border);
  border-radius:6px;
  padding:2px 8px;
  background:rgba(255,255,255,.04);
  color:var(--fg);
  font-size:.8rem;
}
.app-main {
  flex:1;
  width:100%;
  display:grid;
  grid-template-columns:minmax(200px,260px) minmax(360px,520px) minmax(200px,260px);
  justify-content:center;
  align-items:start;
  gap:32px;
  padding-top:40px;
  padding-bottom:64px;
}
.stage-column {
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:20px;
}
.stage-wrap {
  position:relative;
  width:100%;
  box-shadow:var(--shadow);
  border-radius:24px;
  overflow:hidden;
  background:linear-gradient(180deg,#0b0f16,#0e1116);
  display:flex;
  align-items:center;
  justify-content:center;
  padding:16px;
}
canvas#game {
  display:block;
  width:100%;
  height:100%;
  background:radial-gradient(120% 120% at 50% 0%, #0e1420 0%, #0b0f16 60%, #070a0e 100%);
  touch-action:none;
  border-radius:16px;
}

.hud {
  background:var(--panel);
  border:1px solid var(--panel-border);
  border-radius:16px;
  padding:20px;
  display:flex;
  flex-direction:column;
  gap:12px;
  box-shadow:var(--shadow);
  min-height:100%;
}
.hud h2 { margin:0; font-size:.9rem; color:var(--muted); letter-spacing:.08em; text-transform:uppercase; }
.hud section { display:flex; flex-direction:column; gap:4px; }
.hud-val { font-weight:700; font-size:1.3rem; }

.mini { width:100%; background:var(--cell); border-radius: 12px; }

.hud-right { align-self:start; }
.hud-left { align-self:start; }

.stage-footer {
  width:100%;
  background:var(--panel);
  border:1px solid var(--panel-border);
  border-radius:16px;
  padding:18px 24px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:24px;
  box-shadow:var(--shadow);
}
.stage-footer .btn { min-width:160px; }
.stage-timer h2 { margin:0; font-size:.85rem; color:var(--muted); letter-spacing:.08em; text-transform:uppercase; }
.stage-timer .hud-val { font-size:1.5rem; }

@media (max-width: 1100px) {
  .app-main {
    grid-template-columns:minmax(360px,520px);
    justify-content:center;
  }
  .hud-left,
  .hud-right,
  .stage-column {
    width:100%;
  }
}

.panel-wrap{position:fixed; inset:0; pointer-events:none;}
.panel { position:fixed; inset:0; display:flex; align-items:center; justify-content:center; padding:env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left); backdrop-filter:blur(8px); opacity:0; transform:translateY(20px); pointer-events:none; transition:opacity .2s ease, transform .2s ease; }
.panel.show { opacity:1; transform:translateY(0); pointer-events:auto; }
.panel > * { background:var(--panel); border:1px solid var(--panel-border); border-radius:16px; padding:18px; box-shadow:var(--shadow); min-width:clamp(260px,90dvw,360px); }
.panel h2 { margin-top: 0; }
.panel .grid2 { display:grid; grid-template-columns: 1fr 1fr; gap:10px; }
.panel .panel-actions { display:flex; gap:8px; margin-top: 12px; }

.help { margin:.5rem 0 0 1rem; line-height:1.7; }

.btn { appearance: none; border: 1px solid var(--panel-border); border-radius: 10px; background: var(--btn); color: var(--fg); padding: .6rem .9rem; cursor:pointer; transition: transform .05s ease, background .2s ease; }
.btn:hover { background: var(--btn-hover); transform: translateY(-1px); }
.btn.primary { background: linear-gradient(180deg,#2d8847,#2a6e41); border-color: rgba(0,0,0,.15); }
.btn.ghost { background: transparent; }
.btn.full { width:100%; }


@media (prefers-reduced-motion: reduce){
  *,*::before,*::after{animation-duration:.01ms!important;animation-iteration-count:1!important;transition-duration:.01ms!important;}
}

/* FPS badge */
.fps { position:absolute; top:6px; left:6px; font: 12px/1.2 ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono"; opacity:.8; background: rgba(0,0,0,.35); padding:4px 6px; border-radius:6px; }
